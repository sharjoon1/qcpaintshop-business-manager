<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimate Settings - Quality Colours</title>
    <script src="/js/auth-helper.js"></script>
    <script>checkAuthOrRedirect();</script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/universal-nav-loader.js"></script>
</head>
<body class="bg-gray-50">
<div class="max-w-4xl mx-auto p-4 pt-20">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Estimate Display Settings</h2>
            
            <!-- Column Visibility -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Column Visibility</h3>
                <p class="text-sm text-gray-600 mb-4">Choose which columns to display in estimates</p>
                
                <div class="space-y-3">
                    <!-- Always Visible -->
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border-2 border-gray-200">
                        <div>
                            <label class="font-semibold text-gray-700">#, Item Details, Total</label>
                            <p class="text-xs text-gray-500">Always visible</p>
                        </div>
                        <span class="text-gray-400">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </span>
                    </div>
                    
                    <!-- Toggleable Columns -->
                    <div class="flex items-center justify-between p-4 bg-white rounded-lg border-2 border-gray-200 hover:border-purple-300 transition">
                        <div>
                            <label class="font-semibold text-gray-700">QTY/AREA</label>
                            <p class="text-xs text-gray-500">Show quantity and area</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="col-qty" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-white rounded-lg border-2 border-gray-200 hover:border-purple-300 transition">
                        <div>
                            <label class="font-semibold text-gray-700">MIX INFO</label>
                            <p class="text-xs text-gray-500">Show tin combination (4×20L + 1×10L)</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="col-mix" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-white rounded-lg border-2 border-gray-200 hover:border-purple-300 transition">
                        <div>
                            <label class="font-semibold text-gray-700">BREAKDOWN</label>
                            <p class="text-xs text-gray-500">Show cost breakdown (4×₹980 + 1×₹500)</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="col-breakdown" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-white rounded-lg border-2 border-gray-200 hover:border-purple-300 transition">
                        <div>
                            <label class="font-semibold text-gray-700">COLOR COST</label>
                            <p class="text-xs text-gray-500">Show additional color charges</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="col-color" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- GST Display -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">GST Display</h3>
                <p class="text-sm text-gray-600 mb-4">How to show GST in estimates</p>
                
                <div class="space-y-3">
                    <label class="flex items-start p-4 bg-white rounded-lg border-2 border-gray-200 hover:border-purple-300 cursor-pointer transition">
                        <input type="radio" name="gst-display" value="inclusive" class="mt-1 mr-4" checked>
                        <div>
                            <div class="font-semibold text-gray-700">Inclusive GST (Recommended)</div>
                            <p class="text-xs text-gray-500 mt-1">Grand Total: ₹46,793.00<br><span class="text-xs text-gray-400">(GST included in price)</span></p>
                        </div>
                    </label>
                    
                    <label class="flex items-start p-4 bg-white rounded-lg border-2 border-gray-200 hover:border-purple-300 cursor-pointer transition">
                        <input type="radio" name="gst-display" value="breakdown" class="mt-1 mr-4">
                        <div>
                            <div class="font-semibold text-gray-700">Show GST Breakdown</div>
                            <p class="text-xs text-gray-500 mt-1">
                                Subtotal (excl. GST): ₹39,655.08<br>
                                GST @18%: ₹7,137.92<br>
                                <span class="font-semibold">Grand Total: ₹46,793.00</span>
                            </p>
                        </div>
                    </label>
                </div>
            </div>
            
            <!-- Preview -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Preview</h3>
                <div class="bg-gray-50 rounded-lg p-4 border-2 border-gray-200 overflow-x-auto">
                    <table class="w-full text-xs">
                        <thead class="bg-gray-800 text-white">
                            <tr>
                                <th class="px-2 py-2 text-left">#</th>
                                <th class="px-2 py-2 text-left">ITEM</th>
                                <th class="px-2 py-2 text-left" id="preview-qty">QTY/AREA</th>
                                <th class="px-2 py-2 text-left" id="preview-mix">MIX INFO</th>
                                <th class="px-2 py-2 text-left" id="preview-breakdown">BREAKDOWN</th>
                                <th class="px-2 py-2 text-left" id="preview-color">COLOR</th>
                                <th class="px-2 py-2 text-right">TOTAL</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr>
                                <td class="px-2 py-2">1</td>
                                <td class="px-2 py-2">Paint Product</td>
                                <td class="px-2 py-2" id="preview-qty-val">2350</td>
                                <td class="px-2 py-2" id="preview-mix-val">4×20L+1×10L</td>
                                <td class="px-2 py-2" id="preview-breakdown-val">4×₹980...</td>
                                <td class="px-2 py-2" id="preview-color-val">0</td>
                                <td class="px-2 py-2 text-right">₹24,880</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Save Button -->
            <div class="flex gap-4">
                <button onclick="saveSettings()" class="flex-1 bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition font-semibold shadow-lg">
                    Save Settings
                </button>
                <button onclick="resetSettings()" class="px-6 py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition font-semibold">
                    Reset to Default
                </button>
            </div>
        </div>
    </div>

    <script>
        // Load settings
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('estimate_settings') || '{}');
            
            document.getElementById('col-qty').checked = settings.show_qty !== false;
            document.getElementById('col-mix').checked = settings.show_mix !== false;
            document.getElementById('col-breakdown').checked = settings.show_breakdown !== false;
            document.getElementById('col-color').checked = settings.show_color !== false;
            
            const gstDisplay = settings.gst_display || 'inclusive';
            document.querySelector(`input[value="${gstDisplay}"]`).checked = true;
            
            updatePreview();
        }

        // Update preview
        function updatePreview() {
            const showQty = document.getElementById('col-qty').checked;
            const showMix = document.getElementById('col-mix').checked;
            const showBreakdown = document.getElementById('col-breakdown').checked;
            const showColor = document.getElementById('col-color').checked;
            
            // Toggle column visibility in preview
            togglePreviewColumn('qty', showQty);
            togglePreviewColumn('mix', showMix);
            togglePreviewColumn('breakdown', showBreakdown);
            togglePreviewColumn('color', showColor);
        }

        function togglePreviewColumn(col, show) {
            const header = document.getElementById(`preview-${col}`);
            const value = document.getElementById(`preview-${col}-val`);
            
            if (show) {
                header.classList.remove('hidden');
                value.classList.remove('hidden');
            } else {
                header.classList.add('hidden');
                value.classList.add('hidden');
            }
        }

        // Save settings
        function saveSettings() {
            const settings = {
                show_qty: document.getElementById('col-qty').checked,
                show_mix: document.getElementById('col-mix').checked,
                show_breakdown: document.getElementById('col-breakdown').checked,
                show_color: document.getElementById('col-color').checked,
                gst_display: document.querySelector('input[name="gst-display"]:checked').value
            };
            
            localStorage.setItem('estimate_settings', JSON.stringify(settings));
            alert('Settings saved! They will apply to all estimates.');
            history.back();
        }

        // Reset settings
        function resetSettings() {
            if (confirm('Reset to default settings?')) {
                localStorage.removeItem('estimate_settings');
                loadSettings();
                alert('Settings reset to default');
            }
        }

        // Listen to changes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updatePreview);
        });

        // Load on page load
        loadSettings();
    </script>
</body>
</html>
